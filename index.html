<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Information</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.development.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.development.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.1.9/Recharts.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .container {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 1200px;
      margin-bottom: 20px;
    }
    .box {
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      margin: 10px;
      width: 45%;
    }
    .box img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
    }
    .box h3 {
      margin-top: 0;
    }
    .chart-box {
      width: 100%;
      max-width: 600px;
    }
    .info-box {
      width: 100%;
      max-width: 400px;
    }
    .flex-row {
      display: flex;
      justify-content: space-between;
    }
    .box p {
      margin: 10px 0;
    }
    .box.chart-box {
      padding: 0; /* Remove padding as it's handled by the React component */
      background-color: rgb(245, 243, 255); /* Light purple background */
    }
    
    /* You might need to adjust some of your existing box styles */
    .chart-box {
      width: 100%;
      max-width: 800px; /* Increased to accommodate the new design */
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="diagnosis-history-root" class="box chart-box">
      <!-- The React component will be mounted here -->
    </div>

    <div class="box info-box">
      <h3>Jessica Taylor</h3>
      <img id="profile-picture" alt="Profile Picture">
      <div id="patient-details"></div>
    </div>
  </div>

  <div class="container">
    <div class="box">
      <h3>Respiratory Rate</h3>
      <p>20 (Normal)</p>
    </div>

    <div class="box">
      <h3>Temperature</h3>
      <p>98.6°F (Normal)</p>
    </div>

    <div class="box">
      <h3>Heart Rate</h3>
      <p>78 (Lower than Average)</p>
    </div>
  </div>

  <div class="container">
    <div class="box">
      <h3>Diagnostic List</h3>
      <ul id="diagnostic-list"></ul>
    </div>

    <div class="box">
      <h3>Lab Results</h3>
      <ul id="lab-results"></ul>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const patientNameEl = document.getElementById("patient-name");
      const patientDetailsEl = document.getElementById("patient-details");
      const profilePicEl = document.getElementById("profile-picture");
      const diagnosticListEl = document.getElementById("diagnostic-list");
      const labResultsEl = document.getElementById("lab-results");

      const API_URL = "https://fedskillstest.coalitiontechnologies.workers.dev";
      const AUTH_HEADER = {
        "Authorization": "Basic " + btoa("coalition:skills-test")
      };

      async function fetchPatientData() {
        try {
          const response = await fetch(API_URL, {
            headers: AUTH_HEADER
          });

          const data = await response.json();

          // Find Jessica Taylor in the response data
          const jessica = data.find(patient => patient.name === "Jessica Taylor");

          if (jessica) {
            // Populate basic patient details
            profilePicEl.src = jessica.profile_picture;
            patientDetailsEl.innerHTML = `
              <p>Age: ${jessica.age}</p>
              <p>Gender: ${jessica.gender}</p>
              <p>Date of Birth: ${new Date(jessica.date_of_birth).toLocaleDateString()}</p>
              <p>Phone: ${jessica.phone_number}</p>
              <p>Emergency Contact: ${jessica.emergency_contact}</p>
              <p>Insurance: ${jessica.insurance_type}</p>
            `;

            // Filter the diagnosis history for the last 6 months and extract blood pressure data
            const sixMonthsAgo = new Date();
            sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
            const bloodPressureData = jessica.diagnosis_history
              .filter(entry => new Date(entry.year, new Date().getMonth() - 1).getTime() >= sixMonthsAgo.getTime())
              .map(entry => ({
                month: entry.month,
                systolic: entry.blood_pressure.systolic.value,
                diastolic: entry.blood_pressure.diastolic.value,
              }));

            // Render diagnostic list and lab results
            diagnosticListEl.innerHTML = jessica.diagnostic_list.map(diagnosis => `
              <li>
                <strong>${diagnosis.name}</strong>: ${diagnosis.description} (Status: ${diagnosis.status})
              </li>
            `).join("");

            labResultsEl.innerHTML = jessica.lab_results.map(lab => `
              <li>${lab}</li>
            `).join("");
          } else {
            patientDetailsEl.textContent = "Patient not found.";
          }
        } catch (error) {
          console.error("Error fetching data:", error);
          patientDetailsEl.textContent = "Failed to load data.";
        }
      }


      fetchPatientData();
    });
  </script>

  <script type="module">
    import DiagnosisHistory from './DiagnosisHistory.js';

    const root = ReactDOM.createRoot(document.getElementById('diagnosis-history-root'));
    root.render(React.createElement(DiagnosisHistory));
  </script>
  <script type="text/babel">
    const DiagnosisHistory = () => {
      const data = [
        { month: 'Oct, 2023', systolic: 120, diastolic: 100 },
        { month: 'Nov, 2023', systolic: 118, diastolic: 70 },
        { month: 'Dec, 2023', systolic: 160, diastolic: 110 },
        { month: 'Jan, 2024', systolic: 115, diastolic: 95 },
        { month: 'Feb, 2024', systolic: 148, diastolic: 75 },
        { month: 'Mar, 2024', systolic: 160, diastolic: 78 }
      ];

      return (
        <div className="w-full bg-purple-50 p-6 rounded-lg">
          <div className="flex justify-between items-center mb-4">
            <h3 className="text-lg font-medium">Blood Pressure</h3>
            <select className="bg-transparent border-none text-gray-600 text-sm focus:outline-none cursor-pointer">
              <option>Last 6 months</option>
            </select>
          </div>
          <div className="flex">
            <div className="flex-1">
              <LineChart
                width={500}
                height={250}
                data={data}
                margin={{ top: 5, right: 30, bottom: 20, left: -20 }}
              >
                <CartesianGrid 
                  strokeDasharray="3 3" 
                  horizontal={true}
                  vertical={false}
                />
                <XAxis 
                  dataKey="month" 
                  interval={0}
                  tick={{ fontSize: 12, fill: '#666' }}
                  axisLine={false}
                  tickLine={false}
                />
                <YAxis 
                  domain={[60, 180]} 
                  ticks={[60, 80, 100, 120, 140, 160, 180]}
                  axisLine={false}
                  tickLine={false}
                  tick={{ fontSize: 12, fill: '#666' }}
                />
                <Line 
                  type="monotone" 
                  dataKey="systolic" 
                  stroke="#E91E63"
                  strokeWidth={2}
                  dot={{ r: 4, fill: '#E91E63' }}
                  activeDot={{ r: 6 }}
                />
                <Line 
                  type="monotone" 
                  dataKey="diastolic" 
                  stroke="#9C27B0"
                  strokeWidth={2}
                  dot={{ r: 4, fill: '#9C27B0' }}
                  activeDot={{ r: 6 }}
                />
              </LineChart>
            </div>
            <div className="ml-8 flex-none w-48 pt-8">
              <div className="mb-8">
                <div className="flex items-center">
                  <div className="w-2 h-2 rounded-full bg-pink-500 mr-2"></div>
                  <div className="text-gray-600">Systolic</div>
                </div>
                <div className="text-3xl font-bold my-1">160</div>
                <div className="text-gray-600 text-sm flex items-center">
                  <span className="mr-1">▲</span> Higher than Average
                </div>
              </div>
              <div className="mb-8">
                <div className="flex items-center">
                  <div className="w-2 h-2 rounded-full bg-purple-500 mr-2"></div>
                  <div className="text-gray-600">Diastolic</div>
                </div>
                <div className="text-3xl font-bold my-1">78</div>
                <div className="text-gray-600 text-sm flex items-center">
                  <span className="mr-1">▼</span> Lower than Average
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('diagnosis-history-root'));
    root.render(React.createElement(DiagnosisHistory));
  </script>

  <!-- Also add Babel for JSX support -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
</body>
</html>
